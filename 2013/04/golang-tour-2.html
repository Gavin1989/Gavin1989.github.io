<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Go语言之旅——基本概念（二）</title>
  
    <meta name="author" content="Gao Xu">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/twitter/stylesheets/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css" type="text/css" rel="stylesheet" media="all">
 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Gavin Droider</a>
          <ul class="nav">
            
              


  <li><a href="/archive">Archive</a></li>


            
              


  <li><a href="/tags">Tags</a></li>


            
              


  <li><a href="/categories">Categories</a></li>


            
              


  <li><a href="/pages">Pages</a></li>


            
              


  <li><a href="/about">About Me</a></li>


            
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        <div class="page-header">
  <h1>Go语言之旅——基本概念（二） </h1>
</div>

<div class="row">
  <div class="span8">
    <p>##结构体
结构体是字段的集合，Go中使用type关键字来声明它。
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    X int
    y int
}</p>

<p>func main() {
    fmt.Println(Vertex{1, 2})
}</code></pre>
可以使用点号来访问结构体字段：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    X int
    Y int
}</p>

<p>func main() {
    v := Vertex{1, 2}
    v.X = 4
    fmt.Println(v.X)
}</code></pre>
Go有指针，但是没有指针运算。可以通过指针访问结构体字段，通过指针的间接访问是透明的。
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    X int
    Y int
}</p>

<p>func main() {
    p := Vertex{1, 2}
    q := &amp;p
    q.X = 1e9
    fmt.Println(p)
}</code></pre>
结构体字面量（Struct Literals）表示通过列出结构体字段的值来新分配一个结构体（Literal这个词不好理解，详情猛击<a href="http://en.wikipedia.org/wiki/Literal_(computer_programming">维基百科</a>)）。
使用Name:语法可以只列出一部分字段，而且和字段名的顺序无关。
使用特殊的前缀&amp;会构造一个结构体字面量的指针。
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    X, Y int
}</p>

<p>var (
    p = Vertex{1, 2} // has type Vertex
    q = &amp;Vertex{1, 2} // has type *Vertex
    r = Vertex{X: 1} // Y:0 is implicit
    s = Vertex{} // X:0 and Y:0
)</p>

<p>func main() {
    fmt.Println(p, q, r, s)
}</code></pre>
new(T)表达式分配一个零初始化的T值，并返回一个指向它的指针。
<pre><code>var t *T = new(T)</code></pre>
或：
<pre><code>t := new(T)</code></pre>
示例：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    X, Y int
}</p>

<p>func main() {
    v := new(Vertex)
    fmt.Println(v)
    v.X, v.Y = 11, 9
    fmt.Println(v)
}</code></pre>
##Slices（切片）
slice指向一个数组的值，同时还包含有长度信息。[]T是一个元素类型为T的slice。
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>func main() {
    p := []int{2, 3, 5, 7, 11, 13}
    fmt.Println(&ldquo;p ==&rdquo;, p)</p>

<pre><code>for i := 0; i &lt; len(p); i++ {
    fmt.Printf(&quot;p[%d] == %d\n&quot;, i, p[i])
}
</code></pre>

<p>}</code></pre>
slice可以重新切片，即创建一个新的切片指向同一个数组。
表达式：
<pre><code>s[lo:hi]</code></pre>
表示从lo到hi-1的元素的一个切片，包含边界。
<pre><code>s[lo:lo]</code></pre>
为空，但是：
<pre><code>s[lo:lo+1]</code></pre>
有一个元素。示例代码：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>func main() {
    p := []int{2, 3, 5, 7, 11, 13}
    fmt.Println(&ldquo;p ==&rdquo;, p)
    fmt.Println(&ldquo;p[1:4] ==&ldquo;, p[1:4])</p>

<pre><code>// missing low index implies 0
fmt.Println(&quot;p[:3] ==&quot;, p[:3])

// missing high index implies len(s)
fmt.Println(&quot;p[4:] ==&quot;, p[4:])
</code></pre>

<p>}</code></pre>
使用make函数创建slice，它分配一个归零的数组并返回这个数组的slice：
<pre><code>a := make([]int, 5) // len(a)=5</code></pre>
要指定容量的话，就要使用第三个参数：
<pre><code>b := make([]int, 0, 5) // len(b)=0, cap(b)=5</p>

<p>b = b[:cap(b)] // len(b)=5, cap(b)=5
b = b[1:]      // len(b)=4, cap(b)=4</code></pre>
示例代码：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>func main() {
    a := make([]int, 5)
    printSlice(&ldquo;a&rdquo;, a)
    b := make([]int, 0, 5)
    printSlice(&ldquo;b&rdquo;, b)
    c := b[:2]
    printSlice(&ldquo;c&rdquo;, c)
    d := c[2:5]
    printSlice(&ldquo;d&rdquo;, d)
}</p>

<p>func printSlice(s string, x []int) {
    fmt.Printf(&ldquo;%s len=%d cap=%d %v\n&rdquo;,
        s, len(x), cap(x), x)
}</code></pre>
slice的零值是nil。一个nil slice的长度和容量都是0。
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>func main() {
    var z []int
    fmt.Println(z, len(z), cap(z))
    if z == nil {
        fmt.Println(&ldquo;nil!&rdquo;)
    }
}</code></pre>
##Range
使用for循环的range形式可以遍历map或slice：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>var pow = []int{1, 2, 4, 8, 16, 32, 64, 128}</p>

<p>func main() {
    for i, v := range pow {
        fmt.Printf(&ldquo;2**%d = %d\n&rdquo;, i, v)
    }
}</code></pre>
如果想要略过索引或值，可以将其设置为_。如果只想使用索引，可以直接去掉“,value”部分：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>func main() {
    pow := make([]int, 10)
    for i, value := range pow {
        fmt.Printf(&ldquo;%d : %d\n&rdquo;, i, value)
    }
    for i := range pow {
        pow[i] = 1 &lt;&lt; uint(i)
    }
    for _, value := range pow {
        fmt.Printf(&ldquo;%d\n&rdquo;, value)
    }
}</code></pre>
##Map
map是映射键到值的映射表。map必须在使用前用make函数创建（不是new），一个值为nil的map是空的，并且不能被赋值：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    Lat, Long float64
}</p>

<p>var m map[string]Vertex</p>

<p>func main() {
    m = make(map[string]Vertex)
    m[&ldquo;Bell Labs&rdquo;] = Vertex{
        40.68433, -74.39967,
    }
    fmt.Println(m[&ldquo;Bell Labs&rdquo;])
}</code></pre>
map字面量与结构体字面量相似，只不过必须有键：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    Lat, Long float64
}</p>

<p>var m = map[string]Vertex{
    &ldquo;Bell Labs&rdquo; : Vertex{
        40.68433, -74.39967,
    },
    &ldquo;Google&rdquo; : Vertex{
        37.42202, -122.08408,
    },
}</p>

<p>func main() {
    fmt.Println(m)
}</code></pre>
如果顶层类型只有类型名的话，就可以忽略字面量中元素的类型：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>type Vertex struct {
    Lat, Long float64
}</p>

<p>var m = map[string]Vertex{
    &ldquo;Bell Labs&rdquo; : {40.68433, -74.39967},
    &ldquo;Google&rdquo; : {37.42202, -122.08408},
}</p>

<p>func main() {
    fmt.Println(m)
}</code></pre>
在map m中插入或更新一个元素：
<pre><code>m[key] = elem</code></pre>
获得一个元素：
<pre><code>elem = m[key]</code></pre>
删除一个元素：
<pre><code>delete[m, key]</code></pre>
通过双赋值来检测某个键是否存在：
<pre><code>// 如果m中存在key，ok为true；否则ok为false，并且elem的值为map元素类型的零值。
// 同样，如果读取一个不存在于map中的元素时，得到的将会是map中元素类型的零值。
elem, ok := m[key]</code></pre>
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>func main() {
    m := make(map[string]int)</p>

<pre><code>m[&quot;Answer&quot;] = 42
fmt.Println(&quot;The value:&quot;, m[&quot;Answer&quot;])

m[&quot;Answer&quot;] = 48
fmt.Println(&quot;The value:&quot;, m[&quot;Answer&quot;])

delete(m, &quot;Answer&quot;)
fmt.Println(&quot;The value:&quot;, m[&quot;Answer&quot;])

v, ok := m[&quot;Answer&quot;]
fmt.Println(&quot;The value:&quot;, v, &quot;Present?&quot;, ok)
</code></pre>

<p>}</code></pre>
##函数
函数也是值：
<pre><code>package main</p>

<p>import(
    &ldquo;fmt&rdquo;
    &ldquo;math&rdquo;
)</p>

<p>func main() {
    hypot := func(x, y float64) float64 {
        return math.Sqrt(x*x + y*y)
    }</p>

<pre><code>fmt.Println(hypot(3, 4))
</code></pre>

<p>}</code></pre>
函数是完全闭包的。下例中，函数adder返回一个闭包，每个闭包都被绑定到了它自己的sum变量上：
<pre><code>package main</p>

<p>import &ldquo;fmt&rdquo;</p>

<p>func adder() func(int) int {
    sum := 0
    return func(x int) int {
        sum += x
        return sum
    }
}</p>

<p>func main() {
    pos, neg := adder(), adder()
    for i := 0; i &lt; 10; i++ {
        fmt.Println(
            pos(i),
            neg(-2*i),
        )
    }
}</code></pre>
##Switch
case体是自动break的，除非它以一个fallthrough语句结束。
<pre><code>package main</p>

<p>import (
    &ldquo;fmt&rdquo;
    &ldquo;runtime&rdquo;
)</p>

<p>func main() {
    fmt.Print(&ldquo;Go runs on &ldquo;)
    switch os := runtime.GOOS; os {
    case &ldquo;darwin&rdquo;:
        fmt.Println(&ldquo;OS X.&rdquo;)
    case &ldquo;linux&rdquo;:
        fmt.Println(&ldquo;Linux.&rdquo;)
    case &ldquo;windows&rdquo;:
        fmt.Println(&ldquo;Windows.&rdquo;)
        fallthrough
    default:
        // freesd, openbsd
        // plan9
        fmt.Printf(&ldquo;%s.&rdquo;, os)
    }
}</code></pre>
switch的条件从上到下执行，当匹配成功时停止：
<pre><code>package main</p>

<p>import (
    &ldquo;fmt&rdquo;
    &ldquo;time&rdquo;
)</p>

<p>func main() {
    fmt.Println(&ldquo;When&rsquo;s Saturday?&rdquo;)
    today := time.Now().Weekday()
    switch time.Saturday {
    case today + 0:
        fmt.Println(&ldquo;Today.&rdquo;)
    case today + 1:
        fmt.Println(&ldquo;Tomorrow.&rdquo;)
    case today + 2:
        fmt.Println(&ldquo;In two days.&rdquo;)
    default:
        fmt.Println(&ldquo;Too far aways.&rdquo;)
    }
}</code></pre>
没有条件的switch与switch true一样。这种构造可以以一种更简洁的方式书写if-then-else：
<pre><code>package main</p>

<p>import (
    &ldquo;fmt&rdquo;
    &ldquo;time&rdquo;
)</p>

<p>func main() {
    t := time.Now()
    switch {
    case t.Hour() &lt; 12:
        fmt.Println(&ldquo;Good morning!&rdquo;)
    case t.Hour() &lt; 17:
        fmt.Println(&ldquo;Good afternoon.&rdquo;)
    default:
        fmt.Println(&ldquo;Good evening&rdquo;)
    }
}</code></pre></p>

    <hr>
    <div class="pagination">
      <ul>
        <ul>
          
            <li class="prev"><a href="/2013/04/golang-tour-method-and-interface.html" title="Go语言之旅——方法与接口">&larr; Previous</a></li>
          
          

            <li><a href="/archive">Archive</a></li>

          
            <li class="next"><a href="/2013/04/golang-tour-1.html" title="Go语言之旅——基本概念（一）">Next &rarr;</a></li>
          
          
        </ul>
      </ul>
    </div>
    <hr>
    
<div id="disqus_thread"></div>
<script>
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>2013-04-17 14:24:37</span></div>
    <br>
    <h4>Categories</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/categories/#Go-ref">Go <span>17</span></a>
</li>
    
    </ul>
    <br>
    <h4>Tags</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/tags/#golang-ref">golang <span>1</span></a>
</li>
    
    </ul>
  </div>
</div>

      </div>

      <footer>
        <p>&copy; Gao Xu 2013 
          with help from <a href="http://github.com/wendal/gor" target="_blank" title="Gor -- Fast Blog">Gor</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
		  and Idea from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>

    
<script>
    var _gaq=[['_setAccount','UA-123-12'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
  </body>
</html>
