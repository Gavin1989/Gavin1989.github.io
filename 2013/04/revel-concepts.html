<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Revel框架——基本概念</title>
  
    <meta name="author" content="Gao Xu">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/twitter/stylesheets/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css" type="text/css" rel="stylesheet" media="all">
 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Gavin Droider</a>
          <ul class="nav">
            
              


  <li><a href="/archive">Archive</a></li>


            
              


  <li><a href="/tags">Tags</a></li>


            
              


  <li><a href="/categories">Categories</a></li>


            
              


  <li><a href="/pages">Pages</a></li>


            
              


  <li><a href="/about">About Me</a></li>


            
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        <div class="page-header">
  <h1>Revel框架——基本概念 </h1>
</div>

<div class="row">
  <div class="span8">
    <p>##概念
Revel依赖于约定，即在应用中规定一个明确的架构，这使你用MVC模式构建web应用变得简单。作为回报，它的结构非常轻量级，并且开发周期非常快。
##MVC
快速总结：</p>

<ul>
<li>Model是描述应用域的重要数据对象，它也封装了指定域查询和更新数据的逻辑。</li>
<li>View描述了数据怎么呈现以及操作。在revel中，使用模板（template）来呈现数据以及引导用户。</li>
<li>Controller处理请求。它们执行用户期待的动作，并决定要显示哪个view，以及准备和提供view渲染必需的数据。</li>
</ul>

<p>网上有很多优秀的MVC架构的概述，尤其是Play！Framework，revel的思路完全来源于Play!Framework。
##Goroutine每一个请求
Revel构建于Go HTTP Server之上，它为每一个到来的请求都创建一个goroutine（轻量级的线程）来进行处理。它的含义是你的代码可以自由地阻塞，但是必须能够处理并发的请求进程。
##Controllers和Actions
一个HTTP请求调用一个action，action处理请求并且将结果写入到响应中。相关的action组成了controllers。</p>

<hr />

<p>Controller可以是嵌入*revel.Controller为第一个字段的任意类型。<br />
例如：<br />
<pre><code>type AppController struct {
    *revel.Controller
}</code></pre>
revel.Controller是请求的上下文（Context）。它包含了请求和响应的数据。下面是它及其辅助类型的定义，详情请参阅<a href="http://robfig.github.io/revel/docs/godoc/controller.html#Controller">godoc</a>：
<pre><code>type Controller struct {
    Name          string          // controller的名字, 例如：&rdquo;Application&rdquo;
    Type          *ControllerType // controller类型的描述
    MethodType    *MethodType     // 调用的action类型的描述
    AppController interface{}     // 实例化的controller</p>

<pre><code>Request  *Request
Response *Response
Result   Result

Flash      Flash                  // 用户的cookie, 每个请求后都会清除
Session    Session                // Session, 存储在cookie, 已签名.
Params     Params                 // 来自Url和表格的参数 (包含多个).
Args       map[string]interface{} // 每个请求暂存的空间.
RenderArgs map[string]interface{} // 传递给template的参数.
Validation *Validation            // 数据验证助手
Txn        *sql.Tx                // 默认为Nil, 但可用于app / 插件
</code></pre>

<p>}</p>

<p>// Flash表示一个每次请求都会被覆盖的cookie.
// 它允许跨页面存储数据.
// 它通常用于实现成功或失败信息.
// 例如Post/Redirect/Get模式: <a href="http://en.wikipedia.org/wiki/Post/Redirect/Get">http://en.wikipedia.org/wiki/Post/Redirect/Get</a>
type Flash struct {
    Data, Out map[string]string
}</p>

<p>// 它提供一个关于请求参数的统一视图.
// 包括:
// - URL查询字符串
// - 表格值
// - 文件上传
type Params struct {
    url.Values
    Files map[string][]*multipart.FileHeader
}</p>

<p>// 一个已签名的cookie(从而大小被限制为4kb).
// 约束: Key中不能有冒号(:).
type Session map[string]string</p>

<p>type Request struct {
    *http.Request
    ContentType string
}</p>

<p>type Response struct {
    Status      int
    ContentType string
    Headers     http.Header
    Cookies     []*http.Cookie</p>

<pre><code>Out http.ResponseWriter
</code></pre>

<p>}</code></pre>
作为处理HTTP请求的一部分，Revel实例化一个你Controller的实例，并且为嵌入的revel.Controller设置所有的属性。Revel不在请求间共享Controller实例。</p>

<hr />

<p>Action可以是满足下列条件的任意Controller上的方法：</p>

<ul>
<li>是可输出的</li>
<li>返回一个revel.Result</li>
</ul>

<p>例如：
<pre><code>func (c AppController) ShowLogin(username string) revel.Result {
    &hellip;
    return c.Render(username)
}</code></pre>
上例中调用revel.Controller.Render来执行一个template，并将username作为参数传递给它。revel.Controller上有很多生产revel.Result的方法，但是应用也可以自由创建自己的方法。
##Result
Result可以是任意符合下面接口的类型：
<pre><code>type Result interface {
    Apply(req *Request, resp *Response)
}</code></pre>
通常情况下，在action返回一个Result之前不会将数据写入到响应中。接收到Result时，Revel先写入响应头和cookies（例如设置会话cookie），然后调用Result.Apply来写入真正的响应内容。<br />
（action可以选择直接写入到响应，但这估计只能用于特殊情况。例如，在这些情况下，需要自己处理保存会话和Flash数据。）</p>

    <hr>
    <div class="pagination">
      <ul>
        <ul>
          
            <li class="prev"><a href="/2013/04/gavin-s-ndk.html" title="新篇章——NDK">&larr; Previous</a></li>
          
          

            <li><a href="/archive">Archive</a></li>

          
            <li class="next"><a href="/2013/04/golang-tour-concurrent.html" title="Go语言之旅——并发">Next &rarr;</a></li>
          
          
        </ul>
      </ul>
    </div>
    <hr>
    
<div id="disqus_thread"></div>
<script>
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>2013-05-12</span></div>
    <br>
    <h4>Categories</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/categories/#Go-ref">Go <span>17</span></a>
</li>
    
    </ul>
    <br>
    <h4>Tags</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/tags/#Go-ref">Go <span>16</span></a>
</li>
    
      <li>
  <a href="/tags/#revel-ref">revel <span>10</span></a>
</li>
    
    </ul>
  </div>
</div>

      </div>

      <footer>
        <p>&copy; Gao Xu 2013 
          with help from <a href="http://github.com/wendal/gor" target="_blank" title="Gor -- Fast Blog">Gor</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
		  and Idea from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint linenums";
  }
  prettyPrint();
</script>

    
<script>
    var _gaq=[['_setAccount','UA-123-12'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
  </body>
</html>
